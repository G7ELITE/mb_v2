INFO:     Will watch for changes in these directories: ['/home/devbael/mb-v2']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [13381] using StatReload
/home/devbael/mb-v2/.venv/lib/python3.12/site-packages/pydantic/_internal/_fields.py:161: UserWarning: Field "model_id" has conflict with protected namespace "model_".

You may be able to resolve this warning by setting `model_config['protected_namespaces'] = ()`.
  warnings.warn(
INFO:     Started server process [13383]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     127.0.0.1:58468 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:42572 - "GET /api/rag/simulate/stream?message=teste%20basico&safe_mode=true HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache miss para tÃ³pico: teste, executando busca
ğŸ¯ Nenhum lead selecionado, usando 'Primeira interaÃ§Ã£o'
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache miss para tÃ³pico: teste, executando busca
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=300, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 141 caracteres
â­ï¸ ComparaÃ§Ã£o semÃ¢ntica DESABILITADA - usando resposta direta da IA
INFO:     127.0.0.1:55686 - "POST /api/rag/simulate HTTP/1.1" 200 OK
INFO:     127.0.0.1:59838 - "GET /api/rag/simulate/stream?message=ele%20usa%20sinais&safe_mode=true HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache miss para tÃ³pico: 0cf44161, executando busca
Cached resultado para tÃ³pico: 0cf44161
ğŸ¯ CONTEXTO CONSTRUÃDO: 3 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - Ele usa sinais?
NÃ£o, ele nÃ£o depende de sinais, ele opera sozinho....
   Hit 2: Score 0.950 - Ele usa sinais para otc?
SÃ³ usa sinais para otc, porem sÃ³ sÃ¡bado e domingo....
   Hit 3: Score 0.363 - Preciso ter experiÃªncia pra usar?
NÃ£o precisa, o robÃ´ faz tudo sozinho. VocÃª sÃ³ conecta e deixa roda...
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
WARNING:  StatReload detected changes in 'app/api/rag.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [13383]
/home/devbael/mb-v2/.venv/lib/python3.12/site-packages/pydantic/_internal/_fields.py:161: UserWarning: Field "model_id" has conflict with protected namespace "model_".

You may be able to resolve this warning by setting `model_config['protected_namespaces'] = ()`.
  warnings.warn(
INFO:     Started server process [14784]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app/api/rag.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [14784]
/home/devbael/mb-v2/.venv/lib/python3.12/site-packages/pydantic/_internal/_fields.py:161: UserWarning: Field "model_id" has conflict with protected namespace "model_".

You may be able to resolve this warning by setting `model_config['protected_namespaces'] = ()`.
  warnings.warn(
INFO:     Started server process [14993]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /health HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /health HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /health HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /health HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/leads?page=1&page_size=50&sort_by=created_at&sort_dir=desc&mock=false HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
Lead RAG deletado: ID 1
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "DELETE /api/rag/leads/1 HTTP/1.1" 200 OK
Lead RAG criado: junin (ID: 1)
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/leads HTTP/1.1" 200 OK
Placeholders desconhecidos no prompt: ['mensagem_atual', 'historico_mensagens']
Prompt RAG personalizado salvo: 428 caracteres
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "PUT /api/rag/prompt HTTP/1.1" 200 OK
ğŸ¯ Usando histÃ³rico REAL do lead 'junin' (0 mensagens)
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache miss para tÃ³pico: otc, executando busca
Cached resultado para tÃ³pico: otc
ğŸ¯ CONTEXTO CONSTRUÃDO: 3 hits incluÃ­dos no contexto
   Hit 1: Score 0.785 - Ele usa sinais para otc?
SÃ³ usa sinais para otc, porem sÃ³ sÃ¡bado e domingo....
   Hit 2: Score 0.652 - Funciona em OTC?
Funciona sim, mas o ideal Ã© usar no mercado aberto que Ã© mais estÃ¡vel....
   Hit 3: Score 0.618 - Ele usa sinais?
NÃ£o, ele nÃ£o depende de sinais, ele opera sozinho....
ğŸ¯ CONTEXTO FINAL: 3 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=opera+otc+com+sinais+na+quinta+feira%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache hit para tÃ³pico: otc
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 85 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
ğŸ¯ CONTEXTO CONSTRUÃDO: 3 hits incluÃ­dos no contexto
   Hit 1: Score 0.785 - Ele usa sinais para otc?
SÃ³ usa sinais para otc, porem sÃ³ sÃ¡bado e domingo....
   Hit 2: Score 0.652 - Funciona em OTC?
Funciona sim, mas o ideal Ã© usar no mercado aberto que Ã© mais estÃ¡vel....
   Hit 3: Score 0.618 - Ele usa sinais?
NÃ£o, ele nÃ£o depende de sinais, ele opera sozinho....
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
ğŸ¯ Usando histÃ³rico REAL do lead 'junin' (4 mensagens)
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache miss para tÃ³pico: be6c048c, executando busca
Cached resultado para tÃ³pico: be6c048c
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
ğŸ¯ CONTEXTO FINAL: 2 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=qual+banca+m%C3%ADnima%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 20 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache hit para tÃ³pico: be6c048c
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
ğŸ¯ Usando histÃ³rico REAL do lead 'junin' (8 mensagens)
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache miss para tÃ³pico: f94de4ef, executando busca
Cached resultado para tÃ³pico: f94de4ef
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
ğŸ¯ CONTEXTO FINAL: 2 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=qual+banca+recomendada%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 60 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache hit para tÃ³pico: f94de4ef
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
Placeholders desconhecidos no prompt: ['mensagem_atual', 'historico_mensagens']
Prompt RAG personalizado salvo: 706 caracteres
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "PUT /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=funciona+otc%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
ğŸ¯ Usando histÃ³rico REAL do lead 'junin' (12 mensagens)
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache miss para tÃ³pico: otc, executando busca
Cached resultado para tÃ³pico: otc
ğŸ¯ CONTEXTO CONSTRUÃDO: 3 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - Funciona em OTC?
Funciona sim, mas o ideal Ã© usar no mercado aberto que Ã© mais estÃ¡vel....
   Hit 2: Score 0.862 - Funciona em celular?
Sim, funciona em celular, computador e notebook....
   Hit 3: Score 0.818 - Ele usa sinais para otc?
SÃ³ usa sinais para otc, porem sÃ³ sÃ¡bado e domingo....
ğŸ¯ CONTEXTO FINAL: 3 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache hit para tÃ³pico: otc
ğŸ¯ CONTEXTO CONSTRUÃDO: 3 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - Funciona em OTC?
Funciona sim, mas o ideal Ã© usar no mercado aberto que Ã© mais estÃ¡vel....
   Hit 2: Score 0.862 - Funciona em celular?
Sim, funciona em celular, computador e notebook....
   Hit 3: Score 0.818 - Ele usa sinais para otc?
SÃ³ usa sinais para otc, porem sÃ³ sÃ¡bado e domingo....
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 70 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=qual+banca+m%C3%ADnima%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
ğŸ¯ Usando histÃ³rico REAL do lead 'junin' (16 mensagens)
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache miss para tÃ³pico: be6c048c, executando busca
Cached resultado para tÃ³pico: be6c048c
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
ğŸ¯ CONTEXTO FINAL: 2 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 20 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 13 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 13 seÃ§Ãµes
Cache hit para tÃ³pico: be6c048c
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Base de conhecimento atualizada: 868 caracteres
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "PUT /api/rag/knowledge-base HTTP/1.1" 200 OK
Lead RAG deletado: ID 1
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "DELETE /api/rag/leads/1 HTTP/1.1" 200 OK
Lead RAG criado: bokinha (ID: 1)
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=funciona+otc%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
ğŸ¯ Usando histÃ³rico REAL do lead 'bokinha' (0 mensagens)
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Cache miss para tÃ³pico: otc, executando busca
Cached resultado para tÃ³pico: otc
ğŸ¯ CONTEXTO CONSTRUÃDO: 3 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - Funciona em OTC?
Funciona sim, mas o ideal Ã© usar no mercado aberto que Ã© mais estÃ¡vel....
   Hit 2: Score 0.844 - Funciona em celular?
Sim, funciona em celular, computador e notebook....
   Hit 3: Score 0.650 - Sim, funciona tanto em demo quanto em real....
ğŸ¯ CONTEXTO FINAL: 3 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 70 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Cache hit para tÃ³pico: otc
ğŸ¯ CONTEXTO CONSTRUÃDO: 3 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - Funciona em OTC?
Funciona sim, mas o ideal Ã© usar no mercado aberto que Ã© mais estÃ¡vel....
   Hit 2: Score 0.844 - Funciona em celular?
Sim, funciona em celular, computador e notebook....
   Hit 3: Score 0.650 - Sim, funciona tanto em demo quanto em real....
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
ğŸ¯ Usando histÃ³rico REAL do lead 'bokinha' (4 mensagens)
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Cache miss para tÃ³pico: be6c048c, executando busca
Cached resultado para tÃ³pico: be6c048c
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
ğŸ¯ CONTEXTO FINAL: 2 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=qual+banca+m%C3%ADnima%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 2 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Cache hit para tÃ³pico: be6c048c
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
ğŸ¯ Usando histÃ³rico REAL do lead 'bokinha' (8 mensagens)
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Cache miss para tÃ³pico: f94de4ef, executando busca
Cached resultado para tÃ³pico: f94de4ef
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
ğŸ¯ CONTEXTO FINAL: 2 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=qual+banca+recomendada%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 15 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Cache hit para tÃ³pico: f94de4ef
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
ğŸ¯ Usando histÃ³rico REAL do lead 'bokinha' (12 mensagens)
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Cache hit para tÃ³pico: f94de4ef
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
ğŸ¯ CONTEXTO FINAL: 2 hits apÃ³s threshold 0.05
ğŸ¯ Usando prompt personalizado da interface (100% controlado pelo usuÃ¡rio)
ğŸ“ Prompt formatado com 1 linhas de histÃ³rico
ğŸš€ FAZENDO CHAMADA REAL PARA OPENAI - Modelo: gpt-4o
âš™ï¸ ParÃ¢metros: temp=0.3, max_tokens=400, top_p=1.0
ğŸ¯ Embedding Model: text-embedding-3-large (para RAG)
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/simulate/stream?message=qual+banca+recomendada%3F&safe_mode=true&lead_id=1 HTTP/1.1" 200 OK
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
âœ… RESPOSTA REAL RECEBIDA: 15 caracteres
ğŸ”„ ComparaÃ§Ã£o semÃ¢ntica HABILITADA - verificando automaÃ§Ãµes...
ğŸ“‹ Nenhuma automaÃ§Ã£o melhor encontrada, usando resposta da IA
ğŸ“ HistÃ³rico REAL atualizado para lead 1: +2 mensagens
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "POST /api/rag/simulate HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
ğŸ“‹ Parser FAQ: 12 seÃ§Ãµes de perguntas/respostas criadas
KB carregada: 12 seÃ§Ãµes
Cache hit para tÃ³pico: f94de4ef
ğŸ¯ CONTEXTO CONSTRUÃDO: 2 hits incluÃ­dos no contexto
   Hit 1: Score 0.950 - qual a banca minima?
60...
   Hit 2: Score 0.950 - qual a banca ideal?
pra cima de 500...
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /health HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /health HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/leads?page=1&page_size=50&sort_by=created_at&sort_dir=desc&mock=false HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/presets HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/models HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/prompt HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/leads HTTP/1.1" 200 OK
INFO:     2804:1054:4018:caf0:fdf6:c62a:e97c:203b:0 - "GET /api/rag/knowledge-base HTTP/1.1" 200 OK
